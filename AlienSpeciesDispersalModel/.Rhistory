source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
library(AlienSpeciesDispersalModel)
library(AlienSpeciesDispersalModel)
installed.packages("Rtools")
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
if (makeplot){
graphics.off()
x11(width=10,height=8)
op <- par(mar=rep(0,4))
plot(roads_shp,axes=T,
panel.first=rect(par("usr")[1],par("usr")[3],par("usr")[2],par("usr")[4],col = gray(0.95)))
}
## subsequent steps ######
max_times <- 1000 # simulation steps
plot_times <- c(1,2,3,4,5,6,7,8,9,round(seq(10,max_times,length.out=10))) # used for plotting
x <- 0
tmp <- proc.time()
for (t in 1:max_times){
node_state_sub <- node_state[state>0,] # take a subset of occupied nodes, required to speed up 'merge' below
nextnodes <- road_netw[FromNode%in%node_state_sub$FromNode] # identify next nodes
nextnodes <- merge(nextnodes,node_state_sub,by="FromNode") # merge old states and next nodes
newstate <- nextnodes[,1-prod(1-(state * disp)),by=ToNode] # combine all probs arriving at the same node
node_state[.(newstate$ToNode),newarrivals:=newstate$V1] # add new state to nodes file
node_state[,state:=1-((1-state)*(1-newarrivals))]   # combine old and new state
### plotting (not ideal as it requires a subset of the road shapefile, which can only be calculated at the end of the simulation; to make the plot the simulation has to be repeated with the now availabe shapefile subet)
if (makeplot){
x <- x + 1
if (t%in%plot_times){ # plot only few steps
# roads_shp_sub <- subset(roads_shp,Von_Knoten%in%node_state[state>0,FromNode]) ## create the shapefile subset, not ideal...
node_shp_sub <- subset(nodes_shp,Knoten_Num%in%node_state[state>0,FromNode])
dat_nodes <- node_shp_sub@data
dat_nodes <- cbind(dat_nodes,1:dim(dat_nodes)[1])
colnames(dat_nodes)[2] <- "order"
dat_nodes$Knoten_Num <- as.numeric(dat_nodes$Knoten_Num)
nodes_col <- merge(node_state,dat_nodes,by.x="FromNode",by.y="Knoten_Num",all.y=T)
nodes_col$norm <- log(nodes_col$state+1)
nodes_col$norm <- round((nodes_col$norm/max(nodes_col$norm)*100)+1)
nodes_col$col <- colour[nodes_col$norm]
nodes_col <- nodes_col[order(nodes_col$order)]
points(node_shp_sub,col=nodes_col$col,pch=16,cex=0.6)
points(subset(node_shp_sub,Knoten_Num==init_node),pch=1,cex=1,col="blue",lwd=2)
mtext(t,side=3,line=-2)
}
}
}
if (makeplot) par(op)
print(proc.time() - tmp)
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
road_netw$disp
f_attach(1:250,att1,att2,att3,p=1)
plot(f_attach(1:250,att1,att2,att3,p=1))
## attachment kernel parameters
att1 <- 0.6556
att2 <- -0.05
att3 <- 0.3311
#f_disp <- function(D) exp(b*exp(c*(D^g)))
plot(f_attach(1:250,att1,att2,att3,p=1))
plot(f_airflow(1:250,air1,air2,p=1))
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
library(AlienSpeciesDispersalModel)
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread.R')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
plot(sort(road_netw$disp),type="l")
road_netw[,traf_prob:=f_traff(Traffic,traf1)]
road_netw[,attach_prob:=f_attach(Length,att1,att2,att3,a0)]
road_netw[,airflow_prob:=f_airflow(Length,air1,air2,a0)]
road_netw[,disp:=traf_prob*attach_prob*airflow_prob]
plot(sort(road_netw$disp),type="l")
f_airflow
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
plot(sort(road_netw$disp),type="l")
plot(sort(road_netw$p_traff),type="l")
plot(sort(road_netw$p_attach),type="l")
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
plot(sort(road_netw$p_attach),type="l")
plot(sort(road_netw$p_airflow),type="l")
1*.2
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
log(1)
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
plot(sort(road_netw$p_attach),type="l")
plot(sort(road_netw$p_airflow),type="l")
plot(sort(road_netw$disp),type="l")
plot(sort(exp(road_netw$disp)),type="l")
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
nodes_col
hist(nodes_col$state)
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
x
j
Knoten_Num%in%init_node
subset(node_shp_sub,Knoten_Num%in%init_node)
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
subset(places_shp,name=="Hamburg")
subset(places_shp,name=="Hamburg_Hafen")
subset(places_shp,name=="Hamburg Hafen")
subset(places_shp,name=="HamburgHafen")
subset(nodes_shp,coordinates=="9.998816, 53.55026")
subset(nodes_shp,coordinates=="9.99881")
subset(nodes_shp,coords==9.99881)
str(nodes_shp)
subset(nodes_shp,coords.x1==9.99881)
nodes_shp@coords.x1==9.99881
nodes_shp@coord$coords.x1==9.99881
nodes_shp@coords$coords.x1==9.99881
subset(nodes_shp@coords,coords.x1==9.99881)
hist(nodes_shp@coords$coords.x1)
str(nodes_shp@coords)
head(nodes_shp@coords)
head(nodes_shp@coords[,1])
nodes_shp@Data$Knoten_Num[nodes_shp@coords$coords.x1==9.998816 & nodes_shp@coords$coords.x1==53.55026]
nodes_shp@data$Knoten_Num[nodes_shp@coords$coords.x1==9.998816 & nodes_shp@coords$coords.x1==53.55026]
nodes_shp@data$Knoten_Num[nodes_shp@coords$[,1]==9.998816 & nodes_shp@coords[,2]==53.55026]
nodes_shp@data$Knoten_Num[nodes_shp@coords[,1]==9.998816 & nodes_shp@coords[,2]==53.55026]
nodes_shp@data$Knoten_Num[nodes_shp@coords[,1]==9.99881 & nodes_shp@coords[,2]==53.5502]
nodes_shp@data$Knoten_Num[nodes_shp@coords[,1]>9.99881 & nodes_shp@coords[,1]<9.99882 & nodes_shp@coords[,2]>53.5502 & nodes_shp@coords[,2]<53.5503]
nodes_shp@data$Knoten_Num[nodes_shp@coords[,1]>9.98 & nodes_shp@coords[,1]<10 & nodes_shp@coords[,2]>53.54 & nodes_shp@coords[,2]<53.56]
nodes_shp@data$Knoten_Num[nodes_shp@coords[,1]>9.99 & nodes_shp@coords[,1]<10 & nodes_shp@coords[,2]>53.54 & nodes_shp@coords[,2]<53.56]
nodes_shp@data$Knoten_Num[nodes_shp@coords[,1]>9.99 & nodes_shp@coords[,1]<10 & nodes_shp@coords[,2]>53.55 & nodes_shp@coords[,2]<53.56]
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
nodes_Ham<-nodes_shp@data$Knoten_Num[nodes_shp@coords[,1]>9.99 & nodes_shp@coords[,1]<10 & nodes_shp@coords[,2]>53.55 & nodes_shp@coords[,2]<53.56]
subset(nodes_shp,Knoten_Num%in%nodes_Ham)
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
.37+.81-.36
install.packages("magick")
library(magick)
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
dev.off()
dev.off()
animation <- image_animate(img, fps = 2)
print(animation)
img
print(img)
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
x11()
print(animation)
animation
image_write(animation, "gapminderSimulationTest.gif")
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
source('~/GitHub/AlienSpeciesSpread/ModelRoadAttachmentSpread2.r')
