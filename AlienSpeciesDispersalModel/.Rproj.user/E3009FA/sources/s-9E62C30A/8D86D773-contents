getNeighbourSegm<- function(shapeObj,init_coords){

  ## extract coordinates from shapefile
  res <- lapply(slot(shapeObj, "lines"), function(x) lapply(slot(x, "Lines"),function(y) slot(y, "coords")))
  names(res)<-shapeObj@data$ID
  segsID<-sapply(lapply(res,"[[",1),nrow)

    coords<-as.data.frame(do.call("rbind",lapply(res,"[[",1)),stringsAsFactors=F)
   coords$ID<-rep(names(segsID),segsID)

    library(SearchTrees)


    ## create a 'search tree' from coordinates
    tree <- createTree(coords[,1:2]) # required to calculate the nearest neighbour for each ship coordinate and check if it within a range to the next port

    ## get ID of nearest segment, the ID is the same as in road_shp (at least, it should be)
    inds <- knnLookup(tree,newdat=init_coords,k=1) # lookup nearest neighbour, 'k' determines the number of nearest neighbors
    inds<-coords[inds,3]
    return(inds)
}

